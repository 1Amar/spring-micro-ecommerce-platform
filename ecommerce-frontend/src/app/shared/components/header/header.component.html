<!-- Main Header -->
<mat-toolbar class="navbar-custom mat-elevation-1" color="primary">
  <div class="container-fluid">
    <div class="navbar-content">
      
      <!-- Mobile Menu Toggle -->
      <button 
        mat-icon-button 
        class="mobile-menu-toggle d-md-none"
        (click)="toggleMenu()"
        aria-label="Menu">
        <mat-icon>menu</mat-icon>
      </button>

      <!-- Logo/Brand -->
      <div class="navbar-brand">
        <a routerLink="/home" class="brand-link">
          <mat-icon class="brand-icon">shopping_cart</mat-icon>
          <span class="brand-text">ECommerce</span>
        </a>
      </div>

      <!-- Search Bar -->
      <div class="search-container d-none d-md-flex">
        <mat-form-field appearance="outline" class="search-field">
          <input 
            matInput 
            [(ngModel)]="searchQuery"
            (keyup.enter)="onSearch()"
            placeholder="Search products..."
            aria-label="Search products">
          <button 
            matSuffix 
            mat-icon-button 
            (click)="onSearch()"
            aria-label="Search">
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>
      </div>

      <!-- Navigation Actions -->
      <div class="navbar-actions">
        
        <!-- Cart -->
        <a routerLink="/cart" mat-icon-button class="cart-button" aria-label="Shopping cart">
          <mat-icon [matBadge]="cartItemCount$ | async" matBadgeColor="accent" aria-hidden="false">shopping_cart</mat-icon>
        </a>

        <!-- User Menu (Logged In) -->
        <ng-container *ngIf="isLoggedIn$ | async; else loginButton">
          <button mat-icon-button [matMenuTriggerFor]="userMenu" class="user-menu-trigger">
            <mat-icon>account_circle</mat-icon>
          </button>
          
          <mat-menu #userMenu="matMenu">
            <div class="user-menu-header">
              <div class="user-info" *ngIf="userProfile$ | async as user">
                <div class="user-name">{{ user.firstName }} {{ user.lastName }}</div>
                <div class="user-email">{{ user.email }}</div>
              </div>
            </div>
            <mat-divider></mat-divider>
            <button mat-menu-item routerLink="/profile">
              <mat-icon>person</mat-icon>
              <span>My Profile</span>
            </button>
            <button mat-menu-item routerLink="/orders">
              <mat-icon>receipt</mat-icon>
              <span>My Orders</span>
            </button>
            <button mat-menu-item routerLink="/profile/addresses">
              <mat-icon>location_on</mat-icon>
              <span>Addresses</span>
            </button>
            <button mat-menu-item routerLink="/profile/payment-methods">
              <mat-icon>payment</mat-icon>
              <span>Payment Methods</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item routerLink="/elk-test">
              <mat-icon>analytics</mat-icon>
              <span>ELK Testing</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="onLogout()">
              <mat-icon>logout</mat-icon>
              <span>Logout</span>
            </button>
          </mat-menu>
        </ng-container>

        <!-- Login Button (Not Logged In) -->
        <ng-template #loginButton>
          <button mat-raised-button color="accent" (click)="onLogin()">
            <mat-icon>login</mat-icon>
            Login
          </button>
        </ng-template>

      </div>
    </div>
  </div>
</mat-toolbar>

<!-- Categories Navigation Bar -->
<nav class="categories-nav d-none d-lg-block">
  <div class="container-fluid">
    <div class="categories-list">
      <a 
        *ngFor="let category of categories$ | async" 
        class="category-link"
        (click)="navigateToCategory(category)">
        {{ category.name }}
      </a>
    </div>
  </div>
</nav>

<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay" [class.show]="isMenuOpen" (click)="toggleMenu()">
  <div class="mobile-menu" (click)="$event.stopPropagation()">
    
    <!-- Mobile Search -->
    <div class="mobile-search">
      <mat-form-field appearance="outline" class="w-100">
        <input 
          matInput 
          [(ngModel)]="searchQuery"
          (keyup.enter)="onSearch(); toggleMenu()"
          placeholder="Search products..."
          aria-label="Search products">
        <button 
          matSuffix 
          mat-icon-button 
          (click)="onSearch(); toggleMenu()"
          aria-label="Search">
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <!-- Mobile Categories -->
    <div class="mobile-categories">
      <h6>Categories</h6>
      <a 
        *ngFor="let category of categories$ | async" 
        class="mobile-category-link"
        (click)="navigateToCategory(category); toggleMenu()">
        {{ category.name }}
      </a>
    </div>

    <!-- Mobile User Actions -->
    <div class="mobile-user-actions" *ngIf="isLoggedIn$ | async">
      <mat-divider></mat-divider>
      <a routerLink="/profile" class="mobile-action-link" (click)="toggleMenu()">
        <mat-icon>person</mat-icon>
        My Profile
      </a>
      <a routerLink="/orders" class="mobile-action-link" (click)="toggleMenu()">
        <mat-icon>receipt</mat-icon>
        My Orders
      </a>
    </div>

  </div>
</div>