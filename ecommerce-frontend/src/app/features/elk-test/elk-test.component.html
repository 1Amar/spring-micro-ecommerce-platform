<!-- System Admin Dashboard -->
<div class="admin-dashboard">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <h1>🎛️ System Admin Dashboard</h1>
    <p>Comprehensive monitoring and testing for microservices platform</p>
    <div class="system-info">
      <span class="info-badge">Environment: {{ environment.production ? 'Production' : 'Development' }}</span>
      <span class="info-badge">Last Updated: {{ lastUpdate | date:'short' }}</span>
    </div>
  </div>

  <!-- Services Status Grid -->
  <div class="services-status-section">
    <h3>📊 Services Health Status</h3>
    <div class="services-grid">
      <div *ngFor="let service of services" 
           class="service-card"
           [ngClass]="'status-' + service.status">
        <div class="service-header">
          <h4>{{ service.name }}</h4>
          <span class="status-indicator" [ngClass]="'indicator-' + service.status">
            {{ service.status | titlecase }}
          </span>
        </div>
        <div class="service-details">
          <p><strong>Port:</strong> {{ service.port }}</p>
          <p *ngIf="service.responseTime"><strong>Response Time:</strong> {{ service.responseTime }}ms</p>
          <p *ngIf="service.lastChecked"><strong>Last Checked:</strong> {{ service.lastChecked | date:'HH:mm:ss' }}</p>
        </div>
        <button (click)="checkSingleService(service)" 
                [disabled]="service.status === 'checking'"
                class="btn btn-sm btn-outline-primary">
          {{ service.status === 'checking' ? '⏳ Checking...' : '🔄 Check Health' }}
        </button>
      </div>
    </div>
    <div class="services-actions">
      <button (click)="checkAllServices()" 
              [disabled]="isCheckingAll"
              class="btn btn-success">
        {{ isCheckingAll ? '⏳ Checking All Services...' : '🚀 Check All Services Health' }}
      </button>
    </div>
  </div>

  <!-- Monitoring Tools Links -->
  <div class="monitoring-section">
    <h3>🔗 Monitoring & Observability Tools</h3>
    <div class="monitoring-grid">
      <div *ngFor="let link of monitoringLinks" class="monitoring-card" [style.border-left-color]="link.color">
        <div class="monitoring-header">
          <span class="monitoring-icon">{{ link.icon }}</span>
          <h4>{{ link.name }}</h4>
        </div>
        <p class="monitoring-description">{{ link.description }}</p>
        <a [href]="link.url" target="_blank" class="btn btn-outline-primary btn-sm">
          🔗 Open {{ link.name }}
        </a>
      </div>
    </div>
  </div>

  <!-- Quick Actions Panel -->
  <div class="quick-actions-section">
    <h3>🧪 System Testing & Actions</h3>
    <div class="actions-grid">
      <div class="action-card">
        <h4>🔗 Correlation ID Testing</h4>
        <p>Test end-to-end request flow across all microservices (WORKING STATE ALPHA)</p>
        <button (click)="runCorrelationIdTest()" 
                [disabled]="isRunning"
                class="btn btn-primary">
          {{ isRunning ? '⏳ Running Test...' : '🚀 Run Correlation ID Test' }}
        </button>
        <div class="correlation-info" *ngIf="currentCorrelationId">
          <strong>Active Correlation ID:</strong>
          <code class="correlation-id">{{ currentCorrelationId }}</code>
          <button (click)="copyToClipboard(currentCorrelationId)" 
                  class="btn btn-sm btn-outline-secondary">
            📋 Copy for Kibana
          </button>
        </div>
      </div>
      
      <div class="action-card">
        <h4>🧹 System Maintenance</h4>
        <p>Clear test results and reset dashboard state</p>
        <button (click)="clearAllData()" class="btn btn-warning">
          🗑️ Clear All Test Data
        </button>
      </div>
      
      <div class="action-card">
        <h4>📈 Quick Metrics</h4>
        <p>View basic system statistics</p>
        <div class="metrics-display">
          <div class="metric">
            <span class="metric-value">{{ testResults.length }}</span>
            <span class="metric-label">Total Tests</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ getSuccessfulTests() }}</span>
            <span class="metric-label">Successful</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ getFailedTests() }}</span>
            <span class="metric-label">Failed</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Test Results Section -->
  <div class="test-results-section">
    <div class="results-header">
      <h3>📋 Test Results & Logs ({{ testResults.length }})</h3>
      <div class="results-filters">
        <button (click)="filterResults('all')" 
                [class.active]="currentFilter === 'all'"
                class="filter-btn">All</button>
        <button (click)="filterResults('success')" 
                [class.active]="currentFilter === 'success'"
                class="filter-btn">Success</button>
        <button (click)="filterResults('error')" 
                [class.active]="currentFilter === 'error'"
                class="filter-btn">Errors</button>
        <button (click)="exportResults()" class="btn btn-sm btn-outline-info">
          📄 Export Results
        </button>
      </div>
    </div>
    
    <div class="results-list" *ngIf="getFilteredResults().length > 0">
      <div *ngFor="let result of getFilteredResults(); let i = index" 
           class="result-item"
           [ngClass]="'result-' + result.status">
        
        <div class="result-header">
          <span class="step-number">{{ i + 1 }}</span>
          <strong>{{ result.step }}</strong>
          <span class="service-badge">{{ result.service }}</span>
          <span class="status-badge" [ngClass]="'status-' + result.status">
            {{ result.status }}
          </span>
          <span class="timestamp">{{ result.timestamp | date:'HH:mm:ss.SSS' }}</span>
          <span *ngIf="result.duration" class="duration">{{ result.duration }}ms</span>
        </div>
        
        <div class="correlation-id">
          <strong>Correlation ID:</strong> <code>{{ result.correlationId }}</code>
        </div>
        
        <div class="result-details" *ngIf="result.response">
          <button (click)="toggleDetails(i)" class="btn btn-sm btn-outline-info">
            {{ showDetails[i] ? 'Hide' : 'Show' }} Response
          </button>
          <pre *ngIf="showDetails[i]" class="response-json">{{ result.response | json }}</pre>
        </div>
        
        <div class="error-details" *ngIf="result.error">
          <strong>Error:</strong> <span class="error-message">{{ result.error }}</span>
        </div>
      </div>
    </div>
    
    <div *ngIf="getFilteredResults().length === 0" class="no-results">
      {{ testResults.length === 0 ? 'No test results yet. Run some tests to see results here!' : 'No results match the current filter.' }}
    </div>
  </div>

  <!-- Troubleshooting Guide -->
  <div class="troubleshooting-section">
    <h3>🔍 Troubleshooting & Analysis Guide</h3>
    <div class="guide-grid">
      <div class="guide-card">
        <h4>📊 Kibana Log Analysis</h4>
        <ol>
          <li>Search for correlation ID: <code>{{ currentCorrelationId || 'your-correlation-id' }}</code></li>
          <li>Filter by service: <code>springAppName: "ecom-order-service"</code></li>
          <li>Sort by timestamp to see request flow</li>
          <li>Look for same correlation ID across multiple services</li>
        </ol>
      </div>
      
      <div class="guide-card">
        <h4>🔗 Jaeger Trace Analysis</h4>
        <ol>
          <li>Search by correlation ID or trace ID</li>
          <li>View service dependency graph</li>
          <li>Analyze request latency breakdown</li>
          <li>Identify bottlenecks and errors</li>
        </ol>
      </div>
      
      <div class="guide-card">
        <h4>📈 Grafana Metrics</h4>
        <ol>
          <li>Check service health dashboards</li>
          <li>Monitor request rates and response times</li>
          <li>View error rates and success rates</li>
          <li>Analyze system resource usage</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Legacy Fallback (hidden by default) -->
<div class="elk-test-container" style="display: none;">
  <div class="test-header">
    <h2>🔍 ELK Stack Testing Dashboard</h2>
    <p>Generate end-to-end correlation-tracked requests for Kibana analysis</p>
  </div>

  <div class="test-controls">
    <div class="control-group">
      <button 
        (click)="runSimpleTest()" 
        [disabled]="isRunning"
        class="btn btn-primary">
        🚀 Simple Gateway Test
      </button>
      
      <button 
        (click)="runWorkingTest()" 
        [disabled]="isRunning"
        class="btn btn-info">
        ✅ Working ELK Test
      </button>
      
      <button 
        (click)="runComplexOrderFlow()" 
        [disabled]="isRunning"
        class="btn btn-success">
        🛒 Complex Order Flow Test
      </button>
      
      <button 
        (click)="runStressTest()" 
        [disabled]="isRunning"
        class="btn btn-warning">
        ⚡ Stress Test (10 requests)
      </button>
      
      <button 
        (click)="runErrorTest()" 
        [disabled]="isRunning"
        class="btn btn-danger">
        💥 Error Simulation Test
      </button>
      
      <button 
        (click)="runCorrelationIdTest()" 
        [disabled]="isRunning"
        class="btn btn-info">
        🔗 Correlation ID Flow Test
      </button>
    </div>

    <div class="search-info" *ngIf="currentCorrelationId">
      <strong>Current Correlation ID:</strong> 
      <code>{{ currentCorrelationId }}</code>
      <button (click)="copyToClipboard(currentCorrelationId)" class="btn btn-sm btn-outline-secondary">
        📋 Copy for Kibana
      </button>
    </div>
  </div>

  <div class="test-results">
    <h3>Test Results ({{ testResults.length }})</h3>
    <div class="results-list" *ngIf="testResults.length > 0">
      <div *ngFor="let result of testResults; let i = index" 
           class="result-item"
           [ngClass]="'result-' + result.status">
        
        <div class="result-header">
          <span class="step-number">{{ i + 1 }}</span>
          <strong>{{ result.step }}</strong>
          <span class="service-badge">{{ result.service }}</span>
          <span class="status-badge" [ngClass]="'status-' + result.status">
            {{ result.status }}
          </span>
          <span class="timestamp">{{ result.timestamp | date:'HH:mm:ss.SSS' }}</span>
          <span *ngIf="result.duration" class="duration">{{ result.duration }}ms</span>
        </div>
        
        <div class="correlation-id">
          <strong>Correlation ID:</strong> <code>{{ result.correlationId }}</code>
        </div>
        
        <div class="result-details" *ngIf="result.response">
          <button (click)="toggleDetails(i)" class="btn btn-sm btn-outline-info">
            {{ showDetails[i] ? 'Hide' : 'Show' }} Response
          </button>
          <pre *ngIf="showDetails[i]" class="response-json">{{ result.response | json }}</pre>
        </div>
        
        <div class="error-details" *ngIf="result.error">
          <strong>Error:</strong> <span class="error-message">{{ result.error }}</span>
        </div>
      </div>
    </div>
    
    <div *ngIf="testResults.length === 0" class="no-results">
      No test results yet. Click the correlation ID test button to start generating ELK logs!
    </div>
  </div>

  <div class="kibana-info">
    <h3>🔍 How to Track Correlation ID Flow in Kibana</h3>
    <ol>
      <li>Open Kibana: <a href="http://localhost:5601" target="_blank">http://localhost:5601</a></li>
      <li>Go to <strong>Discover</strong></li>
      <li>Make sure index pattern is: <code>spring-boot-logs-*</code></li>
      <li>Set time range to <strong>"Last 15 minutes"</strong></li>
      <li><strong>Search for correlation ID:</strong> Copy any correlation ID from above and paste in search</li>
      <li><strong>Filter by service:</strong> <code>springAppName: "ecom-order-service"</code> or <code>"inventory-service"</code> or <code>"payment-service"</code></li>
      <li><strong>Sort by timestamp</strong> to see the request flow order</li>
      <li><strong>Look for patterns:</strong> You should see the same correlation ID across multiple services</li>
    </ol>
    
    <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 4px;">
      <strong>🎯 What to Look For:</strong><br>
      • Same correlation ID appearing in order-service, inventory-service, and payment-service logs<br>
      • Request flow: Gateway → Order Service → Inventory Service → Payment Service<br>
      • Each service should log the received correlation ID<br>
    </div>
  </div>
</div>